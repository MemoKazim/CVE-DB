import time
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from bs4 import BeautifulSoup

def custom_sleep(seconds):
    """
    Custom sleep function with printing countdown.
    
    Args:
        seconds (int): Number of seconds to sleep.
    """
    print(f"Sleeping for {seconds} seconds...")
    for i in range(seconds, 0, -1):
        print(f" {i} ", end='', flush=True)
        time.sleep(1)
    print("")
custom_sleep(5)


def download_exploit(cve_id):
    try:
        chrome_options = Options()
        chrome_options.add_argument('--headless')
        chrome_options.add_argument('--no-sandbox')
        chrome_options.add_argument('--disable-dev-shm-usage')
        driver = webdriver.Chrome(options=chrome_options)
        driver.get(f"https://www.exploit-db.com/search?cve={cve_id}")
        time.sleep(5)
        html_content = driver.page_source
        soup = BeautifulSoup(html_content, 'html.parser')
        table = soup.find('table', {'id': 'exploits-table'})
        hyperlinks_found = False
        for row in table.find_all('tr')[1:]:
            icon = row.find('i', class_='mdi-close')
            if icon:
                continue
            exploit_link = "https://www.exploit-db.com" + row.find('a', href=True)['href']
            print(exploit_link)
            hyperlinks_found = True

        if not hyperlinks_found:
            print("No exploits available")

    except Exception as e:
        print("Something went wrong. No exploits available")

    finally:
        driver.quit()